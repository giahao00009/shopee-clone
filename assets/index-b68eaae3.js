import{u as Ce,r as x,A as ze,n as Se,b as $,t as Fe,l as y,v as Ae,j as i,c as d,L as ne,p as K,w as ce,x as D,Q as Oe,B as se,y as De,z as ie,D as M,E as Me}from"./index-e88f8263.js";var fe=Symbol.for("immer-nothing"),oe=Symbol.for("immer-draftable"),h=Symbol.for("immer-state");function _(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var w=Object.getPrototypeOf;function k(e){return!!e&&!!e[h]}function v(e){var t;return e?he(e)||Array.isArray(e)||!!e[oe]||!!((t=e.constructor)!=null&&t[oe])||I(e)||R(e):!1}var Te=Object.prototype.constructor.toString();function he(e){if(!e||typeof e!="object")return!1;const t=w(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Te}function z(e,t){E(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function E(e){const t=e[h];return t?t.type_:Array.isArray(e)?1:I(e)?2:R(e)?3:0}function G(e,t){return E(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function me(e,t,r){const n=E(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function je(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function I(e){return e instanceof Map}function R(e){return e instanceof Set}function N(e){return e.copy_||e.base_}function H(e,t){if(I(e))return new Map(e);if(R(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&he(e))return w(e)?{...e}:Object.assign(Object.create(null),e);const r=Object.getOwnPropertyDescriptors(e);delete r[h];let n=Reflect.ownKeys(r);for(let c=0;c<n.length;c++){const a=n[c],l=r[a];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(r[a]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[a]})}return Object.create(w(e),r)}function ee(e,t=!1){return B(e)||k(e)||!v(e)||(E(e)>1&&(e.set=e.add=e.clear=e.delete=Ee),Object.freeze(e),t&&z(e,(r,n)=>ee(n,!0))),e}function Ee(){_(2)}function B(e){return Object.isFrozen(e)}var Ie={};function P(e){const t=Ie[e];return t||_(0,e),t}var S;function _e(){return S}function Re(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ae(e,t){t&&(P("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Y(e){J(e),e.drafts_.forEach(Be),e.drafts_=null}function J(e){e===S&&(S=e.parent_)}function le(e){return S=Re(S,e)}function Be(e){const t=e[h];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function ue(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[h].modified_&&(Y(t),_(4)),v(e)&&(e=T(t,e),t.parent_||j(t,e)),t.patches_&&P("Patches").generateReplacementPatches_(r[h].base_,e,t.patches_,t.inversePatches_)):e=T(t,r,[]),Y(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==fe?e:void 0}function T(e,t,r){if(B(t))return t;const n=t[h];if(!n)return z(t,(c,a)=>de(e,n,t,c,a,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return j(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const c=n.copy_;let a=c,l=!1;n.type_===3&&(a=new Set(c),c.clear(),l=!0),z(a,(f,p)=>de(e,n,c,f,p,r,l)),j(e,c,!1),r&&e.patches_&&P("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function de(e,t,r,n,c,a,l){if(k(c)){const f=a&&t&&t.type_!==3&&!G(t.assigned_,n)?a.concat(n):void 0,p=T(e,c,f);if(me(r,n,p),k(p))e.canAutoFreeze_=!1;else return}else l&&r.add(c);if(v(c)&&!B(c)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;T(e,c),(!t||!t.scope_.parent_)&&j(e,c)}}function j(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&ee(t,r)}function Qe(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:_e(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let c=n,a=te;r&&(c=[n],a=F);const{revoke:l,proxy:f}=Proxy.revocable(c,a);return n.draft_=f,n.revoke_=l,f}var te={get(e,t){if(t===h)return e;const r=N(e);if(!G(r,t))return qe(e,r,t);const n=r[t];return e.finalized_||!v(n)?n:n===L(e.base_,t)?(U(e),e.copy_[t]=V(n,e)):n},has(e,t){return t in N(e)},ownKeys(e){return Reflect.ownKeys(N(e))},set(e,t,r){const n=ye(N(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const c=L(N(e),t),a=c==null?void 0:c[h];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(je(r,c)&&(r!==void 0||G(e.base_,t)))return!0;U(e),Z(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return L(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,U(e),Z(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=N(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){_(11)},getPrototypeOf(e){return w(e.base_)},setPrototypeOf(){_(12)}},F={};z(te,(e,t)=>{F[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});F.deleteProperty=function(e,t){return F.set.call(this,e,t,void 0)};F.set=function(e,t,r){return te.set.call(this,e[0],t,r,e[0])};function L(e,t){const r=e[h];return(r?N(r):e)[t]}function qe(e,t,r){var c;const n=ye(t,r);return n?"value"in n?n.value:(c=n.get)==null?void 0:c.call(e.draft_):void 0}function ye(e,t){if(!(t in e))return;let r=w(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=w(r)}}function Z(e){e.modified_||(e.modified_=!0,e.parent_&&Z(e.parent_))}function U(e){e.copy_||(e.copy_=H(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var We=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const l=this;return function(p=a,...A){return l.produce(p,C=>r.call(this,C,...A))}}typeof r!="function"&&_(6),n!==void 0&&typeof n!="function"&&_(7);let c;if(v(t)){const a=le(this),l=V(t,void 0);let f=!0;try{c=r(l),f=!1}finally{f?Y(a):J(a)}return ae(a,n),ue(c,a)}else if(!t||typeof t!="object"){if(c=r(t),c===void 0&&(c=t),c===fe&&(c=void 0),this.autoFreeze_&&ee(c,!0),n){const a=[],l=[];P("Patches").generateReplacementPatches_(t,c,a,l),n(a,l)}return c}else _(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(l,...f)=>this.produceWithPatches(l,p=>t(p,...f));let n,c;return[this.produce(t,r,(l,f)=>{n=l,c=f}),n,c]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){v(e)||_(8),k(e)&&(e=$e(e));const t=le(this),r=V(e,void 0);return r[h].isManual_=!0,J(t),r}finishDraft(e,t){const r=e&&e[h];(!r||!r.isManual_)&&_(9);const{scope_:n}=r;return ae(n,t),ue(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const c=t[r];if(c.path.length===0&&c.op==="replace"){e=c.value;break}}r>-1&&(t=t.slice(r+1));const n=P("Patches").applyPatches_;return k(e)?n(e,t):this.produce(e,c=>n(c,t))}};function V(e,t){const r=I(e)?P("MapSet").proxyMap_(e,t):R(e)?P("MapSet").proxySet_(e,t):Qe(e,t);return(t?t.scope_:_e()).drafts_.push(r),r}function $e(e){return k(e)||_(10,e),pe(e)}function pe(e){if(!v(e)||B(e))return e;const t=e[h];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=H(e,t.scope_.immer_.useStrictShallowCopy_)}else r=H(e,!0);return z(r,(n,c)=>{me(r,n,pe(c))}),t&&(t.finalized_=!1),r}var m=new We,X=m.produce;m.produceWithPatches.bind(m);m.setAutoFreeze.bind(m);m.setUseStrictShallowCopy.bind(m);m.applyPatches.bind(m);m.createDraft.bind(m);m.finishDraft.bind(m);const Ke=1;function Ue(){var re;const e=Ce(),{extendedPurchases:t,setExtendedPurchases:r}=x.useContext(ze),{data:n,refetch:c}=Se({queryKey:["purchases",{status:ie.incart}],queryFn:()=>M.getPurchases({status:ie.incart})}),a=$({mutationFn:s=>M.updatePurchases(s),onSuccess:()=>{c()}}),l=$({mutationFn:s=>M.buyPurchases(s),onSuccess:()=>{Me.success("Thanh toán thành công"),c()}}),f=$({mutationFn:s=>M.deletePurchase(s),onSuccess:()=>{c()}}),A=(re=Fe().state)==null?void 0:re.purchaseId,C=n==null?void 0:n.data.data,Q=x.useMemo(()=>y.every(t,s=>s.checked),[t]),b=x.useMemo(()=>y.filter(t,s=>s.checked),[t]),ge=b.length,be=x.useMemo(()=>y.reduce(b,(s,o)=>s+o.product.price*o.buy_count,0),[b]),xe=x.useMemo(()=>y.reduce(b,(s,o)=>s+(o.product.price_before_discount-o.product.price)*o.buy_count,0),[b]);x.useEffect(()=>{r(s=>{const o=y.keyBy(s,"_id");return y.map(C,u=>{var O;const g=u._id===A;return{...u,disabled:!1,checked:g||!!((O=o[u._id])!=null&&O.checked)}})||[]})},[A,C,r]),x.useEffect(()=>()=>{window.history.replaceState(null,"")},[]),Ae("Cart - Clone shopee");const Ne=s=>o=>{r(X(u=>{u[s].checked=o.target.checked}))},q=()=>{r(s=>y.map(s,o=>({...o,checked:!Q})))},W=(s,o,u)=>{if(u){const g=t[s];r(X(O=>{O[s].disabled=!0})),a.mutate({product_id:g.product._id,buy_count:o})}},ve=s=>o=>{r(X(u=>{u[s].buy_count=o}))},Pe=s=>()=>{const o=t[s]._id;f.mutate([o])},we=()=>{const s=y.map(b,o=>o._id);f.mutate(s)},ke=()=>{if(b.length>0){const s=y.map(b,o=>({product_id:o.product._id,buy_count:o.buy_count}));l.mutate(s)}};return i("div",{className:"bg-neutral-100 py-16",children:i("div",{className:"container",children:t&&t.length>0?d(x.Fragment,{children:[i("div",{className:"overflow-auto",children:d("div",{className:"min-w-[1000px]",children:[d("div",{className:"grid grid-cols-12 rounded-sm bg-white px-9 py-5 text-sm capitalize text-gray-500 shadow",children:[i("div",{className:"col-span-6",children:d("div",{className:"flex items-center",children:[i("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:i("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:Q,onChange:q})}),i("div",{className:"flex-grow text-black",children:"Sản phẩm"})]})}),i("div",{className:"col-span-6",children:d("div",{className:"grid grid-cols-5 text-center",children:[i("div",{className:"col-span-2",children:"Đơn giá"}),i("div",{className:"col-span-1",children:"Số lượng"}),i("div",{className:"col-span-1",children:"Số tiền"}),i("div",{className:"col-span-1",children:"Thao tác"})]})})]}),i("div",{className:"my-3 rounded-sm  p-5 shadow",children:y.map(t,(s,o)=>d("div",{className:"mb-3 grid grid-cols-12 rounded-sm border border-gray-200 bg-white px-4 py-5 text-center text-sm text-gray-500 shadow",children:[i("div",{className:"col-span-6",children:d("div",{className:"flex",children:[i("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:i("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:s.checked,onChange:Ne(o)})}),i("div",{className:"flex-grow",children:d("div",{className:"flex",children:[i(ne,{to:`${K.home.link}${ce({name:s.product.name,id:s.product._id})}`,className:"h-20 w-20 flex-shrink-0",children:i("img",{alt:s.product.name,src:s.product.image})}),i("div",{className:"flex-grow px-2 pb-2 pt-1",children:i(ne,{to:`${K.home.link}${ce({name:s.product.name,id:s.product._id})}`,className:"line-clamp-2",children:s.product.name})})]})})]})}),i("div",{className:"col-span-6",children:d("div",{className:"grid grid-cols-5 text-center",children:[i("div",{className:"col-span-2",children:i("div",{className:"flex items-center justify-center",children:i("span",{className:"text-gray-400 line-through",children:D(s.product.price_before_discount)})})}),i("div",{className:"col-span-1",children:i(Oe,{max:s.product.quantity,value:s.buy_count,classNameWrapper:"flex items-center",onIncrement:u=>{const g=u<=s.product.quantity;return W(o,u,g)},onDecrement:u=>{const g=u>=Ke;return W(o,u,g)},onType:ve(o),onFocusOut:u=>{const g=u>=1&&u<=s.product.quantity&&u!==C[o].buy_count;return W(o,u,g)},disabled:s.disabled})}),i("div",{className:"col-span-1",children:i("span",{className:"text-orange",children:D(s.price*s.buy_count)})}),i("div",{className:"col-span-1",children:i("button",{onClick:Pe(o),className:"bg-none text-black transition-colors hover:text-orange",children:"Xoá"})})]})})]},s._id))})]})}),d("div",{className:"sticky bottom-0 z-10 flex flex-col rounded-sm border border-gray-200 bg-white p-5 shadow sm:flex-row sm:items-center",children:[d("div",{className:"flex items-center",children:[i("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:i("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:Q,onChange:q})}),d("button",{className:"mx-3 border-none bg-none outline-none",onClick:q,children:["Chọn tất cả (",t.length,")"]}),i("button",{className:"mx-3 border-none bg-none outline-none",onClick:we,children:"Xoá"})]}),d("div",{className:"mt-5 flex flex-col sm:ml-auto sm:mt-0 sm:flex-row sm:items-center",children:[d("div",{children:[d("div",{className:"flex items-center sm:justify-end",children:[d("div",{children:["Tổng thanh toán (",ge," sản phẩm):"]}),i("div",{className:"text-2xl text-orange sm:ml-2",children:D(be)})]}),d("div",{className:"flex items-center text-sm sm:justify-end",children:[i("div",{className:"text-gray-500",children:"Tiết kiệm:"}),i("div",{className:"text-orange sm:ml-6",children:D(xe)})]})]}),i(se,{onClick:ke,disabled:l.isLoading,className:"mt-2 h-10 w-full rounded bg-orange text-white shadow hover:opacity-90 sm:ml-2 sm:mt-0 sm:w-48",children:"Mua hàng"})]})]})]}):d("div",{className:"flex flex-col items-center justify-center",children:[i("div",{children:i("img",{src:De,alt:"no product",className:"h-60 w-60"})}),i("div",{className:"mt-2 text-lg capitalize text-orange",children:"Giỏ hàng của bạn còn trống"}),i(se,{onClick:()=>e(K.home.link),className:"mt-3 rounded-sm bg-orange px-3 py-2 text-white outline-none hover:opacity-90",children:"Mua ngay"})]})})})}export{Ue as default};
